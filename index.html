<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>‚àû Lofi Radio</title>
  <link rel="icon" href="image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéß</text></svg>">
  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #0c0f1d, #121a2e, #0a1428);
      --text-color: #f0f0f0;
      --card-bg: rgba(20, 25, 45, 0.7);
      --btn-bg: #ff6b61;
      --btn-hover: #ff523d;
      --track-bg: rgba(255,255,255,0.1);
      --track-border: rgba(255,255,255,0.15);
      --track-active: rgba(255,107,97,0.3);
      --input-bg: rgba(0,0,0,0.2);
      --shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    .light-theme {
      --bg-gradient: linear-gradient(135deg, #f0f9ff, #e0f2fe, #c7e8fc);
      --text-color: #1e293b;
      --card-bg: rgba(255, 255, 255, 0.85);
      --btn-bg: #3b82f6;
      --btn-hover: #2563eb;
      --track-bg: rgba(59,130,246,0.1);
      --track-border: rgba(59,130,246,0.2);
      --track-active: rgba(59,130,246,0.25);
      --input-bg: rgba(241,245,249,0.7);
      --shadow: 0 6px 20px rgba(0,123,255,0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg-gradient);
      color: var(--text-color);
      font-family: 'Segoe UI', system-ui, sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* === –°–ù–ï–ì === */
    #snow-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .snowflake {
      position: absolute;
      background: white;
      border-radius: 50%;
      opacity: 0.6;
    }

    @keyframes fall-drift {
      to { transform: translateY(100vh) translateX(var(--drift, 0px)); }
    }

    /* === –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ === */
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
      position: relative;
      z-index: 2;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    h1 {
      font-size: 1.8rem;
      font-weight: 700;
    }

    #theme-toggle {
      background: var(--track-bg);
      border: 1px solid var(--track-border);
      width: 44px;
      height: 44px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    #theme-toggle:hover {
      background: var(--track-active);
    }

    #player-container {
      width: 100%;
      aspect-ratio: 16 / 9;
      max-width: 640px;
      margin: 15px auto;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: var(--shadow);
      background: var(--card-bg);
      backdrop-filter: blur(10px);
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    #play-btn {
      padding: 12px 28px;
      font-size: 1.1rem;
      background: var(--btn-bg);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      margin-top: 15px;
      box-shadow: 0 4px 12px rgba(255,107,97,0.3);
    }

    .light-theme #play-btn {
      box-shadow: 0 4px 12px rgba(59,130,246,0.3);
    }

    #play-btn:hover {
      background: var(--btn-hover);
      transform: scale(1.04);
    }

    .controls {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      align-items: center;
    }

    .volume-control, .sleep-timer {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #volume-slider {
      width: 120px;
      height: 6px;
      -webkit-appearance: none;
      background: var(--track-border);
      border-radius: 3px;
      outline: none;
    }

    #volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--btn-bg);
      cursor: pointer;
    }

    #sleep-select, #custom-minutes {
      padding: 6px 10px;
      background: var(--input-bg);
      color: var(--text-color);
      border: 1px solid var(--track-border);
      border-radius: 8px;
      font-size: 0.95rem;
    }

    #custom-minutes {
      width: 60px;
      text-align: center;
    }

    #countdown {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #aaa;
    }

    .add-track {
      margin: 25px 0;
      padding: 15px;
      background: var(--card-bg);
      border-radius: 16px;
      backdrop-filter: blur(8px);
    }

    #custom-url {
      width: 100%;
      max-width: 400px;
      padding: 10px 14px;
      background: var(--input-bg);
      border: 1px solid var(--track-border);
      border-radius: 12px;
      color: var(--text-color);
      font-size: 1rem;
      margin-bottom: 10px;
    }

    #add-btn {
      padding: 8px 20px;
      background: var(--btn-bg);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 0.95rem;
    }

    .tracks-section {
      margin-top: 20px;
    }

    .section-title {
      margin: 20px 0 12px;
      font-size: 1.1rem;
      opacity: 0.8;
    }

    .tracks, .custom-tracks {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      padding: 0 10px;
    }

    .track-btn, .custom-track-btn {
      padding: 8px 14px;
      background: var(--track-bg);
      color: var(--text-color);
      border: 1px solid var(--track-border);
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      white-space: nowrap;
    }

    .custom-track-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      border-radius: 12px;
      padding: 8px 12px;
      max-width: 280px;
    }

    .custom-track-btn img {
      width: 40px;
      height: 24px;
      object-fit: cover;
      border-radius: 4px;
    }

    .delete-btn {
      background: none;
      border: none;
      color: #ff6b6b;
      font-size: 1.2rem;
      cursor: pointer;
      padding: 0;
      margin-left: 6px;
    }

    .track-btn:hover, .track-btn.active,
    .custom-track-btn:hover, .custom-track-btn.active {
      background: var(--track-active);
      border-color: var(--btn-bg);
    }

    .note {
      margin-top: 25px;
      font-size: 0.8rem;
      opacity: 0.7;
      line-height: 1.5;
    }

    /* === –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò (–ù–û–í–´–ô –°–õ–ê–ô–î–ï–†) === */
    #recommendations {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 12px;
      padding: 10px;
      background: var(--card-bg);
      border-radius: 16px;
      backdrop-filter: blur(8px);
      max-width: 90vw;
      overflow-x: auto;
      z-index: 3;
      scrollbar-width: none; /* Firefox */
    }

    #recommendations::-webkit-scrollbar {
      display: none; /* Chrome/Safari */
    }

    .rec-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 80px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .rec-item:hover {
      transform: scale(1.05);
    }

    .rec-thumb {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      object-fit: cover;
      margin-bottom: 6px;
    }

    .rec-title-text {
      font-size: 0.75rem;
      text-align: center;
      max-width: 80px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* === –ö–ù–û–ü–ö–ê –°–ù–ï–ì–ê === */
    #snow-toggle {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 48px;
      height: 48px;
      background: rgba(30, 30, 46, 0.6);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 50%;
      color: white;
      font-size: 1.4rem;
      cursor: pointer;
      z-index: 10;
      backdrop-filter: blur(6px);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .light-theme #snow-toggle {
      background: rgba(241, 245, 249, 0.6);
      border-color: rgba(59,130,246,0.3);
      color: #3b82f6;
    }

    #snow-toggle:hover {
      background: rgba(255, 107, 97, 0.4);
    }

    .light-theme #snow-toggle:hover {
      background: rgba(59,130,246,0.2);
    }

    @media (max-width: 600px) {
      h1 { font-size: 1.5rem; }
      #player-container { border-radius: 12px; }
      .track-btn { padding: 7px 12px; font-size: 0.85rem; }
      .custom-track-btn { max-width: 220px; padding: 7px 10px; }
      .custom-track-btn img { width: 36px; height: 22px; }
      #play-btn { font-size: 1rem; padding: 10px 24px; }
      .controls { flex-direction: column; gap: 12px; }
      #volume-slider { width: 150px; }
      #custom-url { font-size: 0.95rem; }
      #snow-toggle { bottom: 80px; right: 15px; width: 44px; height: 44px; font-size: 1.3rem; }
    }
  </style>
</head>
<body class="dark-theme">
  <!-- –°–Ω–µ–≥ -->
  <div id="snow-container"></div>

  <div class="container">
    <header>
      <h1>‚àû Lofi Radio ‚ùÑÔ∏è</h1>
      <button id="theme-toggle" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåì</button>
    </header>

    <div id="player-container">
      <iframe id="lofi-player" 
              src="https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1&loop=1&playlist=jfKfPfyJRdk&controls=1&mute=1&enablejsapi=1"
              allow="autoplay; encrypted-media"
              title="Lofi Girl Radio">
      </iframe>
    </div>

    <button id="play-btn">‚ñ∂ –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É</button>

    <div class="controls">
      <div class="volume-control">
        <span>üîà</span>
        <input type="range" id="volume-slider" min="0" max="100" value="10">
        <span>üîä</span>
      </div>

      <div class="sleep-timer">
        <label for="sleep-select">–¢–∞–π–º–µ—Ä:</label>
        <select id="sleep-select">
          <option value="0">–ù–∏–∫–æ–≥–¥–∞</option>
          <option value="900">15 –º–∏–Ω</option>
          <option value="1800">30 –º–∏–Ω</option>
          <option value="2700">45 –º–∏–Ω</option>
          <option value="3600">60 –º–∏–Ω</option>
          <option value="custom">–°–≤–æ—ë –≤—Ä–µ–º—è</option>
        </select>
        <input type="number" id="custom-minutes" min="1" max="240" value="30" placeholder="–º–∏–Ω" style="display: none;">
      </div>
    </div>

    <div id="countdown"></div>

    <div class="add-track">
      <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π —Å—Ç—Ä–∏–º</h3>
      <input type="text" id="custom-url" placeholder="–°—Å—ã–ª–∫–∞ YouTube (v=...)" />
      <br>
      <button id="add-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>

    <div class="tracks-section">
      <div class="section-title">üéß –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∏–º—ã</div>
      <div class="tracks">
        <button class="track-btn active" data-id="jfKfPfyJRdk">Study Beats</button>
        <button class="track-btn" data-id="5qap5aO4i9A">Chillhop Radio</button>
        <button class="track-btn" data-id="lTRiuFIWV54">Jazz & Rain</button>
        <button class="track-btn" data-id="r4DhZUZQ0Gw">LoFi Dreams</button>
        <button class="track-btn" data-id="IxPANmjPaek">Night Study</button>
        <button class="track-btn" data-id="9Ny1rBqIhXI">Gaming Lofi</button>
      </div>
    </div>

    <div class="tracks-section">
      <div class="section-title">üìÅ –ú–æ–∏ —Å—Ç—Ä–∏–º—ã</div>
      <div class="custom-tracks" id="custom-tracks-container"></div>
    </div>

    <p class="note">–í—Å–µ —Å—Ç—Ä–∏–º—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç.</p>
  </div>

  <!-- –ù–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
  <div id="recommendations">
    <div class="rec-item" data-id="L9JqD8V6U0Y">
      <img class="rec-thumb" src="https://i.ytimg.com/vi/L9JqD8V6U0Y/mqdefault.jpg" alt="1">
      <span class="rec-title-text">Chillhop Short</span>
    </div>
    <div class="rec-item" data-id="mY6S7N4qZ8o">
      <img class="rec-thumb" src="https://i.ytimg.com/vi/mY6S7N4qZ8o/mqdefault.jpg" alt="2">
      <span class="rec-title-text">Guitar Study</span>
    </div>
    <div class="rec-item" data-id="XWb8WvXxJbE">
      <img class="rec-thumb" src="https://i.ytimg.com/vi/XWb8WvXxJbE/mqdefault.jpg" alt="3">
      <span class="rec-title-text">Piano Mix</span>
    </div>
    <div class="rec-item" data-id="5yx6BWlEVcY">
      <img class="rec-thumb" src="https://i.ytimg.com/vi/5yx6BWlEVcY/mqdefault.jpg" alt="4">
      <span class="rec-title-text">Anime Vibes</span>
    </div>
    <div class="rec-item" data-id="DyvXQ5NzXqY">
      <img class="rec-thumb" src="https://i.ytimg.com/vi/DyvXQ5NzXqY/mqdefault.jpg" alt="5">
      <span class="rec-title-text">Chillhop Mix</span>
    </div>
    <div class="rec-item" data-id="7wTw9X6V9K8">
      <img class="rec-thumb" src="https://i.ytimg.com/vi/7wTw9X6V9K8/mqdefault.jpg" alt="6">
      <span class="rec-title-text">Hip Hop Beats</span>
    </div>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ —Å–Ω–µ–≥–∞ -->
  <button id="snow-toggle" title="–í–∫–ª/–≤—ã–∫–ª —Å–Ω–µ–≥">‚ùÑÔ∏è</button>

  <script>
    // === –°–ù–ï–ì ===
    function createSnow() {
      const snow = document.getElementById('snow-container');
      snow.innerHTML = '';
      const flakes = window.innerWidth < 600 ? 80 : 150;
      for (let i = 0; i < flakes; i++) {
        const flake = document.createElement('div');
        flake.className = 'snowflake';
        const size = Math.random() * 3 + 1.5;
        flake.style.width = `${size}px`;
        flake.style.height = `${size}px`;
        flake.style.left = `${Math.random() * 100}%`;
        flake.style.opacity = Math.random() * 0.4 + 0.3;
        flake.style.animationDuration = `${Math.random() * 8 + 4}s`;
        flake.style.animationDelay = `${-Math.random() * 5}s`;
        flake.style.setProperty('--drift', `${(Math.random() - 0.5) * 25}px`);
        flake.style.animationName = 'fall-drift';
        snow.appendChild(flake);
      }
    }

    let snowEnabled = true;
    document.getElementById('snow-toggle').addEventListener('click', () => {
      const snow = document.getElementById('snow-container');
      if (snowEnabled) {
        snow.innerHTML = ''; // –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ–º —Å–Ω–µ–≥
        document.getElementById('snow-toggle').textContent = '‚ûï';
        document.getElementById('snow-toggle').title = '–í–∫–ª—é—á–∏—Ç—å —Å–Ω–µ–≥';
      } else {
        createSnow(); // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º
        document.getElementById('snow-toggle').textContent = '‚ùÑÔ∏è';
        document.getElementById('snow-toggle').title = '–í—ã–∫–ª—é—á–∏—Ç—å —Å–Ω–µ–≥';
      }
      snowEnabled = !snowEnabled;
    });

    // === –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò ===
    document.querySelectorAll('.rec-item').forEach(item => {
      item.addEventListener('click', () => {
        const id = item.dataset.id;
        // –ú–µ–Ω—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–ª–µ–µ—Ä–∞
        document.getElementById('lofi-player').src = 
          `https://www.youtube.com/embed/${id}?autoplay=1&controls=1&enablejsapi=1`;
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–ø—É—Å–∫–∞ (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –º—É–∑—ã–∫–∞ –Ω–µ –∏–≥—Ä–∞–ª–∞)
        document.getElementById('play-btn').style.display = 'inline-block';
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('.track-btn, .custom-track-btn').forEach(b => b.classList.remove('active'));
      });
    });

    // === –¢–ï–ú–ê ===
    const body = document.body;
    const themeToggle = document.getElementById('theme-toggle');
    const savedTheme = localStorage.getItem('lofi-theme') || 'dark';
    
    if (savedTheme === 'light') {
      body.className = 'light-theme';
      themeToggle.textContent = 'üåô';
    }

    themeToggle.addEventListener('click', () => {
      body.className = body.className === 'dark-theme' ? 'light-theme' : 'dark-theme';
      localStorage.setItem('lofi-theme', body.className);
      themeToggle.textContent = body.className === 'dark-theme' ? 'üåì' : 'üåô';
    });

    // === –ü–õ–ï–ï–† ===
    const player = document.getElementById('lofi-player');
    const playBtn = document.getElementById('play-btn');
    const volSlider = document.getElementById('volume-slider');

    playBtn.addEventListener('click', () => {
      const id = document.querySelector('.track-btn.active')?.dataset.id || 'jfKfPfyJRdk';
      const isStream = ['jfKfPfyJRdk','5qap5aO4i9A','lTRiuFIWV54','r4DhZUZQ0Gw','IxPANmjPaek','9Ny1rBqIhXI'].includes(id);
      player.src = isStream 
        ? `https://www.youtube.com/embed/${id}?autoplay=1&loop=1&playlist=${id}&controls=1&enablejsapi=1`
        : `https://www.youtube.com/embed/${id}?autoplay=1&controls=1&enablejsapi=1`;
      
      setTimeout(() => {
        player.contentWindow.postMessage(JSON.stringify({event:'command',func:'playVideo'}), '*');
        player.contentWindow.postMessage(JSON.stringify({event:'command',func:'setVolume',args:[volSlider.value]}), '*');
        playBtn.style.display = 'none';
      }, 800);
    });

    volSlider.addEventListener('input', () => {
      player.contentWindow.postMessage(JSON.stringify({
        event: 'command',
        func: 'setVolume',
        args: [volSlider.value]
      }), '*');
    });

    // === –¢–†–ï–ö–ò ===
    document.querySelectorAll('.track-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.track-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    // === –¢–ê–ô–ú–ï–† –°–ù–ê ===
    let endTime = null;
    const sleepSelect = document.getElementById('sleep-select');
    const customMin = document.getElementById('custom-minutes');
    const countdown = document.getElementById('countdown');

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }

    function updateCountdown() {
      if (!endTime) return;
      const diff = Math.max(0, Math.floor((endTime - Date.now()) / 1000));
      if (diff <= 0) {
        player.contentWindow.postMessage(JSON.stringify({event:'command',func:'stopVideo'}), '*');
        countdown.textContent = 'üí§ –ú—É–∑—ã–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞ –ø–æ —Ç–∞–π–º–µ—Ä—É';
        endTime = null;
        return;
      }
      countdown.textContent = `üí§ –í—ã–∫–ª—é—á–∏—Ç—Å—è —á–µ—Ä–µ–∑: ${formatTime(diff)}`;
      setTimeout(updateCountdown, 1000);
    }

    sleepSelect.addEventListener('change', () => {
      const sec = parseInt(sleepSelect.value);
      if (sec === 0) {
        endTime = null;
        countdown.textContent = '';
      } else if (isNaN(sec)) {
        customMin.style.display = 'inline-block';
        endTime = Date.now() + (parseInt(customMin.value) || 30) * 60000;
      } else {
        customMin.style.display = 'none';
        endTime = Date.now() + sec * 1000;
      }
      updateCountdown();
    });

    customMin.addEventListener('input', () => {
      const mins = Math.min(240, Math.max(1, parseInt(customMin.value) || 30));
      customMin.value = mins;
      endTime = Date.now() + mins * 60000;
      updateCountdown();
    });

    // === –ö–ê–°–¢–û–ú–ù–´–ï –¢–†–ï–ö–ò ===
    function loadCustomTracks() {
      const tracks = JSON.parse(localStorage.getItem('lofi-custom-tracks') || '[]');
      const container = document.getElementById('custom-tracks-container');
      container.innerHTML = '';
      tracks.forEach((track, i) => {
        const btn = document.createElement('div');
        btn.className = 'custom-track-btn';
        if (document.querySelector('.track-btn.active')?.dataset.id === track.id) {
          btn.classList.add('active');
        }
        btn.innerHTML = `
          <img src="${track.thumbnail}" alt="thumb">
          <span>${track.title}</span>
          <button class="delete-btn" data-index="${i}">√ó</button>
        `;
        btn.dataset.id = track.id;
        btn.addEventListener('click', e => {
          if (!e.target.classList.contains('delete-btn')) {
            document.querySelectorAll('.track-btn, .custom-track-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            switchTrack(track.id);
          }
        });
        container.appendChild(btn);
      });

      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          e.stopPropagation();
          const i = parseInt(btn.dataset.index);
          const t = JSON.parse(localStorage.getItem('lofi-custom-tracks') || '[]');
          t.splice(i, 1);
          localStorage.setItem('lofi-custom-tracks', JSON.stringify(t));
          loadCustomTracks();
        });
      });
    }

    function switchTrack(id) {
      const isStream = ['jfKfPfyJRdk','5qap5aO4i9A','lTRiuFIWV54','r4DhZUZQ0Gw','IxPANmjPaek','9Ny1rBqIhXI'].includes(id);
      player.src = isStream 
        ? `https://www.youtube.com/embed/${id}?autoplay=1&loop=1&playlist=${id}&controls=1&enablejsapi=1`
        : `https://www.youtube.com/embed/${id}?autoplay=1&controls=1&enablejsapi=1`;
      
      if (document.getElementById('play-btn').style.display === 'none') {
        setTimeout(() => {
          player.contentWindow.postMessage(JSON.stringify({event:'command',func:'playVideo'}), '*');
          player.contentWindow.postMessage(JSON.stringify({event:'command',func:'setVolume',args:[volSlider.value]}), '*');
        }, 800);
      } else {
        document.getElementById('play-btn').style.display = 'inline-block';
      }
    }

    document.getElementById('add-btn').addEventListener('click', async () => {
      const input = document.getElementById('custom-url').value.trim();
      if (!input) return;

      let videoId = null;
      const regExp = /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
      const match = input.match(regExp);
      if (match && match[2].length === 11) {
        videoId = match[2];
      } else if (input.length === 11 && /^[a-zA-Z0-9_-]+$/.test(input)) {
        videoId = input;
      }

      if (!videoId) {
        alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏');
        return;
      }

      const tracks = JSON.parse(localStorage.getItem('lofi-custom-tracks') || '[]');
      if (tracks.some(t => t.id === videoId)) {
        alert('–£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
        return;
      }

      try {
        const res = await fetch(`https://www.youtube.com/oembed?url=https://youtu.be/${videoId}&format=json`);
        const data = await res.json();
        tracks.push({
          id: videoId,
          title: data.title || videoId,
          thumbnail: `https://i.ytimg.com/vi/${videoId}/mqdefault.jpg`
        });
        localStorage.setItem('lofi-custom-tracks', JSON.stringify(tracks));
        loadCustomTracks();
        document.getElementById('custom-url').value = '';
      } catch (e) {
        alert('–í–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∏–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ');
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    createSnow();
    loadCustomTracks();
  </script>
</body>
</html>
